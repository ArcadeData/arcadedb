<div class="tab-pane fade" id="tab-security" role="tabpanel">
  <div class="d-flex justify-content-around">
    <div class="p-2 flex-grow-1">
      <div>
        <h4><i class="fa fa-shield-alt"></i> Security</h4>
      </div>
    </div>
  </div>

  <hr />

  <div class="d-flex justify-content-around">
    <div class="flex-grow-1">
      <ul class="nav nav-tabs text-center" id="tabs-security" style="float: right">
        <li class="nav-item"><a data-toggle="tab" href="#tab-security-users" class="active show nav-link" id="tab-security-users-sel">Users</a></li>
        <li class="nav-item"><a data-toggle="tab" href="#tab-security-groups" class="nav-link" id="tab-security-groups-sel">User Groups</a></li>
        <li class="nav-item"><a data-toggle="tab" href="#tab-security-tokens" class="nav-link" id="tab-security-tokens-sel">API Tokens</a></li>
      </ul>
    </div>
  </div>

  <br />

  <div class="tab-content px-2">
    <!-- Users & Permissions Tab -->
    <div class="tab-pane fade show active" id="tab-security-users" role="tabpanel">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <span class="text-muted small">Manage server users and their database access permissions.</span>
        <div>
          <button class="btn btn-sm btn-outline-primary" onclick="loadUsers()"><i class="fa fa-sync"></i> Refresh</button>
          <button class="btn btn-sm btn-success" onclick="showCreateUserForm()"><i class="fa fa-plus"></i> Create User</button>
        </div>
      </div>

      <div class="row">
        <div class="col-12">
          <div class="table-responsive">
            <table id="securityUsersTable" class="table table-striped table-sm" style="width: 100%"></table>
          </div>
        </div>
      </div>

      <!-- Create User Modal -->
      <div class="modal fade" id="createUserModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="userModalTitle">Create User</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <div class="row mb-3">
                <div class="col-md-6">
                  <label for="userName" class="form-label">Username</label>
                  <input type="text" class="form-control" id="userName" placeholder="Enter username">
                </div>
                <div class="col-md-6">
                  <label for="userPassword" class="form-label">Password</label>
                  <input type="password" class="form-control" id="userPassword" placeholder="Min 4 characters">
                </div>
              </div>

              <h6>Database Access</h6>
              <p class="text-muted small mb-2">Assign groups per database. Users in the <code>admin</code> group have full access. The <code>*</code> database applies to all databases not explicitly listed.</p>

              <table class="table table-sm table-bordered" id="userDatabasesTable">
                <thead>
                  <tr>
                    <th>Database</th>
                    <th>Groups</th>
                    <th style="width:50px"></th>
                  </tr>
                </thead>
                <tbody>
                  <tr data-db="*">
                    <td><code>*</code> (all databases)</td>
                    <td>
                      <div class="input-group input-group-sm">
                        <select class="form-select user-group-select">
                          <option value="admin">admin</option>
                          <option value="*">* (default)</option>
                        </select>
                      </div>
                    </td>
                    <td></td>
                  </tr>
                </tbody>
              </table>
              <div class="mb-3">
                <div class="input-group input-group-sm" style="max-width: 400px">
                  <select id="userNewDatabase" class="form-select"><option value="">Add database...</option></select>
                  <button class="btn btn-outline-secondary" onclick="addUserDatabaseRow()">Add</button>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-primary" id="userModalSaveBtn" onclick="saveUser()">Create</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- User Groups Tab -->
    <div class="tab-pane fade" id="tab-security-groups" role="tabpanel">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <span class="text-muted small">Manage security groups that define per-type CRUD permissions and database-level access.</span>
        <div>
          <button class="btn btn-sm btn-outline-primary" onclick="loadGroups()"><i class="fa fa-sync"></i> Refresh</button>
          <button class="btn btn-sm btn-success" onclick="showCreateGroupForm()"><i class="fa fa-plus"></i> Create Group</button>
        </div>
      </div>

      <div class="mb-3">
        <label for="groupDatabaseFilter" class="form-label small text-muted">Database:</label>
        <select id="groupDatabaseFilter" class="form-select form-select-sm" style="max-width:250px;display:inline-block" onchange="onGroupDatabaseFilterChange()">
          <option value="*">* (default)</option>
        </select>
      </div>

      <div class="row">
        <div class="col-12">
          <div class="table-responsive">
            <table id="groupsTable" class="table table-striped table-sm" style="width: 100%"></table>
          </div>
        </div>
      </div>

      <!-- Create/Edit Group Modal -->
      <div class="modal fade" id="createGroupModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="groupModalTitle">Create Group</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <div class="row mb-3">
                <div class="col-md-4">
                  <label for="groupDatabase" class="form-label">Database</label>
                  <select id="groupDatabase" class="form-select" onchange="loadTypesForGroupDatabase()">
                    <option value="*">* (All databases)</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label for="groupName" class="form-label">Group Name</label>
                  <input type="text" class="form-control" id="groupName" placeholder="e.g. reader">
                </div>
              </div>

              <div class="row mb-3">
                <div class="col-md-4">
                  <label for="groupResultSetLimit" class="form-label">Result Set Limit</label>
                  <input type="number" class="form-control" id="groupResultSetLimit" value="-1">
                  <small class="text-muted">-1 = unlimited</small>
                </div>
                <div class="col-md-4">
                  <label for="groupReadTimeout" class="form-label">Read Timeout</label>
                  <input type="number" class="form-control" id="groupReadTimeout" value="-1">
                  <small class="text-muted">-1 = unlimited</small>
                </div>
              </div>

              <h6>Type Permissions</h6>
              <table class="table table-sm table-bordered" id="groupPermissionsTable">
                <thead>
                  <tr>
                    <th>Type</th>
                    <th class="text-center" style="width:80px">Create</th>
                    <th class="text-center" style="width:80px">Read</th>
                    <th class="text-center" style="width:80px">Update</th>
                    <th class="text-center" style="width:80px">Delete</th>
                    <th style="width:50px"></th>
                  </tr>
                </thead>
                <tbody>
                  <tr data-type="*">
                    <td><code>*</code> (default)</td>
                    <td class="text-center"><input type="checkbox" class="form-check-input grp-perm-create"></td>
                    <td class="text-center"><input type="checkbox" class="form-check-input grp-perm-read" checked></td>
                    <td class="text-center"><input type="checkbox" class="form-check-input grp-perm-update"></td>
                    <td class="text-center"><input type="checkbox" class="form-check-input grp-perm-delete"></td>
                    <td></td>
                  </tr>
                </tbody>
              </table>
              <div class="mb-3">
                <div class="input-group input-group-sm" style="max-width: 350px">
                  <select id="groupNewType" class="form-select"><option value="">Add type...</option></select>
                  <button class="btn btn-outline-secondary" onclick="addGroupTypeRow()">Add</button>
                </div>
              </div>

              <h6>Database Permissions</h6>
              <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="groupPermSchema"><label class="form-check-label small" for="groupPermSchema">Schema Changes</label></div>
              <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="groupPermSettings"><label class="form-check-label small" for="groupPermSettings">Database Settings</label></div>
              <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="groupPermSecurity"><label class="form-check-label small" for="groupPermSecurity">Security</label></div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-primary" id="groupModalSaveBtn" onclick="saveGroup()">Create</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- API Tokens Tab -->
    <div class="tab-pane fade" id="tab-security-tokens" role="tabpanel">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <span class="text-muted small">Manage long-lived API tokens for programmatic access (MCP, REST API integrations).</span>
        <div>
          <button class="btn btn-sm btn-outline-primary" onclick="loadApiTokens()"><i class="fa fa-sync"></i> Refresh</button>
          <button class="btn btn-sm btn-success" onclick="showCreateTokenForm()"><i class="fa fa-plus"></i> Create Token</button>
        </div>
      </div>

      <div class="row">
        <div class="col-12">
          <div class="table-responsive">
            <table id="apiTokensTable" class="table table-striped table-sm" style="width: 100%"></table>
          </div>
        </div>
      </div>

      <!-- Create Token Modal -->
      <div class="modal fade" id="createTokenModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Create API Token</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <div class="row mb-3">
                <div class="col-md-4">
                  <label for="tokenName" class="form-label">Name</label>
                  <input type="text" class="form-control" id="tokenName" placeholder="e.g. MCP Read-Only">
                </div>
                <div class="col-md-4">
                  <label for="tokenDatabase" class="form-label">Database</label>
                  <select id="tokenDatabase" class="form-select" onchange="loadTypesForTokenDatabase()">
                    <option value="*">* (All databases)</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label for="tokenExpiration" class="form-label">Expiration</label>
                  <input type="date" class="form-control" id="tokenExpiration">
                  <small class="text-muted">Leave empty for no expiration</small>
                </div>
              </div>

              <h6>Type Permissions</h6>
              <table class="table table-sm table-bordered" id="tokenPermissionsTable">
                <thead>
                  <tr>
                    <th>Type</th>
                    <th class="text-center" style="width:80px">Create</th>
                    <th class="text-center" style="width:80px">Read</th>
                    <th class="text-center" style="width:80px">Update</th>
                    <th class="text-center" style="width:80px">Delete</th>
                    <th style="width:50px"></th>
                  </tr>
                </thead>
                <tbody>
                  <tr data-type="*">
                    <td><code>*</code> (default)</td>
                    <td class="text-center"><input type="checkbox" class="form-check-input perm-create"></td>
                    <td class="text-center"><input type="checkbox" class="form-check-input perm-read" checked></td>
                    <td class="text-center"><input type="checkbox" class="form-check-input perm-update"></td>
                    <td class="text-center"><input type="checkbox" class="form-check-input perm-delete"></td>
                    <td></td>
                  </tr>
                </tbody>
              </table>
              <div class="mb-3">
                <div class="input-group input-group-sm" style="max-width: 350px">
                  <select id="tokenNewType" class="form-select"><option value="">Add type...</option></select>
                  <button class="btn btn-outline-secondary" onclick="addTokenTypeRow()">Add</button>
                </div>
              </div>

              <h6>Database Permissions</h6>
              <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="tokenPermSchema"><label class="form-check-label small" for="tokenPermSchema">Schema Changes</label></div>
              <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="tokenPermSettings"><label class="form-check-label small" for="tokenPermSettings">Database Settings</label></div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-primary" onclick="createApiToken()">Create Token</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Token Created Modal -->
      <div class="modal fade" id="tokenCreatedModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header bg-success text-white">
              <h5 class="modal-title">Token Created</h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <div class="alert alert-warning small mb-2">
                <i class="fa fa-exclamation-triangle"></i> Save this token now. It will not be shown again.
              </div>
              <div class="input-group">
                <input type="text" class="form-control font-monospace" id="createdTokenValue" readonly>
                <button class="btn btn-primary" onclick="copyCreatedToken()"><i class="fa fa-copy"></i> Copy</button>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

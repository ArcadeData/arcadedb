<!-- AI Assistant Tab -->
<div class="tab-pane fade" id="tab-ai" role="tabpanel">

  <!-- Inactive state (no subscription) -->
  <div id="aiInactivePanel" style="display: none;">
    <div class="d-flex align-items-center justify-content-center" style="height: 70vh;">
      <div class="text-center" style="max-width: 520px;">
        <i class="fa fa-robot" style="font-size: 3rem; color: var(--color-brand); margin-bottom: 1rem;"></i>
        <h4 style="color: var(--text-primary);">AI Assistant</h4>
        <p style="color: var(--text-secondary); margin-top: 1rem;">
          Get AI-powered database assistance:
        </p>
        <ul class="text-start" style="color: var(--text-muted); font-size: 0.9rem; display: inline-block;">
          <li>Schema review and optimization</li>
          <li>Query optimization and troubleshooting</li>
          <li>Data modeling recommendations</li>
          <li>Server profiling analysis</li>
          <li>Synthetic data generation</li>
          <li>And more...</li>
        </ul>

        <!-- Activation Form -->
        <div style="margin-top: 1.5rem; padding: 1.5rem; border: 1px solid var(--border-main); border-radius: 10px; background: var(--bg-card);">
          <h6 style="color: var(--text-primary); margin-bottom: 0.75rem;">Activate your subscription</h6>
          <p style="color: var(--text-muted); font-size: 0.85rem; margin-bottom: 1rem;">
            Enter your subscription key to enable the AI assistant.
          </p>
          <div class="d-flex gap-2">
            <input type="text" id="aiSubscriptionKey" class="form-control"
              placeholder="Enter your subscription key"
              style="background: var(--bg-input); color: var(--text-primary); border-color: var(--border-main);"
              onkeydown="if(event.key==='Enter') aiActivate()">
            <button id="aiActivateBtn" class="btn" style="background: var(--color-brand); color: white; border: none; min-width: 100px;" onclick="aiActivate()">
              Activate
            </button>
          </div>
          <div id="aiActivateError" style="display: none; margin-top: 0.5rem; color: #dc3545; font-size: 0.85rem;"></div>
          <div id="aiActivateSuccess" style="display: none; margin-top: 0.5rem; color: #28a745; font-size: 0.85rem;"></div>
        </div>

        <p style="color: var(--text-muted); margin-top: 1rem; font-size: 0.85rem;">
          Don't have a key? Contact <a href="mailto:info@arcadedb.com" style="color: var(--color-brand-link);">info@arcadedb.com</a> for more information.
        </p>
      </div>
    </div>
  </div>

  <!-- Active state (with subscription) -->
  <div id="aiActivePanel" style="display: none;">
    <div class="d-flex" style="height: calc(100vh - 60px);">

      <!-- Left sidebar: Chat History -->
      <div id="aiSidebar" style="width: 260px; min-width: 260px; border-right: 1px solid var(--border-main); background: var(--bg-sidebar); display: flex; flex-direction: column;">
        <div style="padding: 12px;">
          <button class="btn btn-sm w-100" style="background: var(--color-brand); color: white; border: none;" onclick="aiNewChat()">
            <i class="fa fa-plus me-1"></i> New Chat
          </button>
        </div>
        <div id="aiChatList" style="flex: 1; overflow-y: auto; padding: 0 8px 8px 8px;">
          <!-- Chat history items populated by JS -->
        </div>
      </div>

      <!-- Main chat area -->
      <div style="flex: 1; display: flex; flex-direction: column; min-width: 0;">

        <!-- Header -->
        <div class="d-flex align-items-center px-3 py-2" style="border-bottom: 1px solid var(--border-main); background: var(--bg-nav);">
          <i class="fa fa-robot me-2" style="color: var(--color-brand); font-size: 1.2rem;"></i>
          <strong style="color: var(--text-primary);">AI Assistant</strong>
          <div class="ms-3">
            <div id="aiDbSelectContainer" class="searchable-db-select"></div>
          </div>
        </div>

        <!-- Messages area -->
        <div id="aiMessages" style="flex: 1; overflow-y: auto; padding: 16px 24px;">
          <!-- Welcome message shown on new chat -->
          <div id="aiWelcome" class="text-center" style="margin-top: 80px;">
            <i class="fa fa-robot" style="font-size: 2.5rem; color: var(--color-brand); opacity: 0.6;"></i>
            <h5 style="color: var(--text-primary); margin-top: 12px;">How can I help you?</h5>
            <p style="color: var(--text-muted); font-size: 0.9rem;">
              Ask me about your database schema, query optimization, data modeling, or synthetic data generation.
            </p>
          </div>
        </div>

        <!-- Input area -->
        <div style="border-top: 1px solid var(--border-main); padding: 12px 24px; background: var(--bg-nav);">
          <div class="d-flex gap-2">
            <textarea id="aiInput" class="form-control" rows="2"
              placeholder="Ask about your database..."
              style="resize: none; background: var(--bg-input); color: var(--text-primary); border-color: var(--border-main);"
              onkeydown="aiHandleInputKeydown(event)"></textarea>
            <button class="btn align-self-end" style="background: var(--color-brand); color: white; border: none; height: 38px; min-width: 70px; white-space: nowrap; display: inline-flex; align-items: center; justify-content: center;" onclick="aiSendMessage()" id="aiSendBtn">
              Send
            </button>
          </div>
        </div>

      </div>
    </div>
  </div>

</div>

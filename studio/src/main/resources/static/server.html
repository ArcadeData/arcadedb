<div class="tab-pane fade" id="tab-server" role="tabpanel">
  <div class="d-flex justify-content-around">
    <div class="p-2 flex-grow-1">
      <div>
        <h4><i class="fa fa-server"></i> Server</h4>
      </div>
      <div class="p-2">
        <span id="serverConnection"></span>
      </div>
    </div>
    <div class="p-2">
      <button class="btn" onclick="shutdownServer()">Shutdown <i class="fas fa-power-off" style="color: red"></i></button>
    </div>
  </div>

  <hr />

  <div class="d-flex justify-content-around">
    <div class="p-1 d-flex align-items-center gap-2">
      <button class="btn btn-pill" onclick="updateServer()">Refresh <i class="fa fa-sync"></i></button>
      <select id="serverRefreshTimeout" class="form-select" onchange="startServerRefreshTimer(true)">
        <option value="0">Off</option>
        <option value="10">Every 10 sec</option>
        <option value="30">Every 30 sec</option>
        <option value="60">Every 1 min</option>
        <option value="300">Every 5 min</option>
      </select>
    </div>
    <div class="flex-grow-1">
      <ul class="nav nav-tabs text-center" id="tabs-database" style="float: right">
        <li class="nav-item"><a data-toggle="tab" href="#tab-server-summary" class="active show nav-link" id="tab-summary-sel">Summary</a></li>
        <li class="nav-item"><a data-toggle="tab" href="#tab-server-sessions" class="nav-link" id="tab-server-sessions-sel">Sessions</a></li>
        <li class="nav-item"><a data-toggle="tab" href="#tab-server-events" class="nav-link" id="tab-server-events-sel">Events</a></li>
        <li class="nav-item"><a data-toggle="tab" href="#tab-metrics" class="nav-link" id="tab-metrics-sel">Metrics</a></li>
        <li class="nav-item"><a data-toggle="tab" href="#tab-server-settings" class="nav-link" id="tab-server-settings-sel">Server Settings</a></li>
        <li class="nav-item"><a data-toggle="tab" href="#tab-server-backup" class="nav-link" id="tab-server-backup-sel">Backup</a></li>
        <li class="nav-item"><a data-toggle="tab" href="#tab-server-mcp" class="nav-link" id="tab-server-mcp-sel">MCP</a></li>
        <li class="nav-item"><a data-toggle="tab" href="#tab-server-tokens" class="nav-link" id="tab-server-tokens-sel">API Tokens</a></li>
      </ul>
    </div>
  </div>

  <br />

  <div class="tab-content px-2">
    <div class="tab-pane fade show active" id="tab-server-summary" role="tabpanel">
      <div class="row">
        <div class="col-6"><b>Operating System</b></div>
        <div class="col-6"><b>ArcadeDB Server</b></div>
      </div>
      <div class="row">
        <div class="col-xs-12 col-md-2">
          <div id="serverChartOSCPU" style="min-height: 220px"></div>
        </div>
        <div class="col-xs-12 col-md-2">
          <div id="serverChartOSRAM" style="min-height: 220px"></div>
        </div>
        <div class="col-xs-12 col-md-2">
          <div id="serverChartOSDisk" style="min-height: 220px"></div>
        </div>
        <div class="col-xs-12 col-md-2">
          <div id="serverChartServerRAM" style="min-height: 220px"></div>
        </div>
        <div class="col-xs-12 col-md-2">
          <div id="serverChartCache" style="min-height: 220px"></div>
        </div>
        <div class="col-xs-12 col-md-2">
          <div id="serverEventsSummary">
            <table style="font-size: 140%; border-spacing: 10px; margin: 0 auto; cursor: pointer" onclick="globalActivateTab('tab-server-events')">
              <tbody>
                <tr>
                  <td style="padding-right: 10px"><span style="color: red">Errors</span></td>
                  <td id="serverEventsSummaryErrors">0</td>
                </tr>
                <tr>
                  <td style="padding-right: 10px"><span style="color: orange">Warnings</span></td>
                  <td id="serverEventsSummaryWarnings">0</td>
                </tr>
                <tr>
                  <td style="padding-right: 10px"><span style="color: blue">Info</span></td>
                  <td id="serverEventsSummaryInfo">0</td>
                </tr>
                <tr>
                  <td style="padding-right: 10px">Hints</td>
                  <td id="serverEventsSummaryHints">0</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="row mt-2">
        <b>HTTP Requests</b>
      </div>
      <div class="row">
        <div class="col-12">
          <div id="serverChartCommands" style="min-height: 250px"></div>
        </div>
      </div>
    </div>

    <div class="tab-pane fade show" id="tab-server-sessions" role="tabpanel">
      <div class="row mb-3">
        <div class="col-12 d-flex justify-content-between align-items-center">
          <span>Active authentication sessions</span>
          <button class="btn btn-sm btn-outline-primary" onclick="loadServerSessions()">
            <i class="fa fa-sync"></i> Refresh
          </button>
        </div>
      </div>
      <div class="row">
        <div class="col-12">
          <div class="table-responsive">
            <table id="serverSessions" class="table table-striped table-sm" style="width: 100%"></table>
          </div>
        </div>
      </div>
    </div>

    <div class="tab-pane fade show" id="tab-server-events" role="tabpanel">
      <div class="row">
        <div class="col-1"><label for="serverEventsFile">File</label></div>
        <div class="col-3"><select id="serverEventsFile"></select></div>
        <div class="col-1"><label for="serverEventsType">Type</label></div>
        <div class="col-1">
          <select id="serverEventsType">
            <option value="ALL">ALL</option>
            <option value="CRITICAL">CRITICAL</option>
            <option value="WARNING">WARNING</option>
            <option value="INFO">INFO</option>
            <option value="HINT">HINT</option>
          </select>
        </div>
        <div class="col-1"><label for="serverEventsComponent">Component</label></div>
        <div class="col-2">
          <select id="serverEventsComponent">
            <option value="ALL">ALL</option>
          </select>
        </div>
        <div class="col-1"><label for="serverEventsDb">Database</label></div>
        <div class="col-2">
          <select id="serverEventsDb">
            <option value="ALL">ALL</option>
          </select>
        </div>
      </div>
      <br />
      <div class="row">
        <div class="col-12">
          <div class="table-responsive">
            <table id="serverEvents" class="table table-striped table-sm" style="width: 100%; table-layout: fixed"></table>
          </div>
        </div>
      </div>
    </div>

    <div class="tab-pane fade show" id="tab-metrics" role="tabpanel">
      <div class="row">
        <div class="col-12">
          <div class="table-responsive">
            <table id="serverMetrics" class="table table-striped table-sm" style="width: 100%; table-layout: fixed"></table>
          </div>
        </div>
      </div>
    </div>

    <div class="tab-pane" id="tab-server-settings" role="tabpanel">
      <div class="row">
        <div class="col-12">
          <div class="table-responsive">
            <table id="serverSettings" class="table table-striped table-sm" style="width: 100%; table-layout: fixed"></table>
          </div>
        </div>
      </div>
    </div>

    <div class="tab-pane fade" id="tab-server-backup" role="tabpanel">
      <div class="row mb-3">
        <div class="col-12">
          <div class="d-flex justify-content-between align-items-center">
            <h5><i class="fa fa-archive"></i> Auto-Backup Configuration</h5>
            <div>
              <button class="btn btn-sm btn-outline-primary" onclick="loadBackupConfig()">
                <i class="fa fa-sync"></i> Refresh
              </button>
              <button class="btn btn-sm btn-success" onclick="saveBackupConfig()">
                <i class="fa fa-save"></i> Save Configuration
              </button>
            </div>
          </div>
        </div>
      </div>

      <div id="backupConfigStatus" class="row mb-3">
        <div class="col-12">
          <div class="alert alert-info" role="alert">
            <span id="backupStatusMessage">Loading backup configuration...</span>
          </div>
        </div>
      </div>

      <div id="backupConfigForm" style="display: none;">
        <div class="card mb-3">
          <div class="card-header">General Settings</div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-4 mb-3">
                <label for="backupEnabled" class="form-label">Auto-Backup Enabled</label>
                <select id="backupEnabled" class="form-select">
                  <option value="true">Yes</option>
                  <option value="false">No</option>
                </select>
              </div>
              <div class="col-md-4 mb-3">
                <label for="backupDirectory" class="form-label">Backup Directory</label>
                <input type="text" class="form-control" id="backupDirectory" value="./backups">
              </div>
              <div class="col-md-4 mb-3">
                <label for="backupRunOnServer" class="form-label">Run On Server</label>
                <select id="backupRunOnServer" class="form-select">
                  <option value="$leader">Leader Only ($leader)</option>
                  <option value="*">All Servers (*)</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <div class="card mb-3">
          <div class="card-header">Schedule</div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-3 mb-3">
                <label for="backupScheduleType" class="form-label">Schedule Type</label>
                <select id="backupScheduleType" class="form-select" onchange="toggleBackupScheduleFields()">
                  <option value="frequency">Frequency-based</option>
                  <option value="cron">CRON Expression</option>
                </select>
              </div>
              <div class="col-md-3 mb-3" id="backupFrequencyGroup">
                <label for="backupFrequency" class="form-label">Frequency (minutes)</label>
                <input type="number" class="form-control" id="backupFrequency" value="60" min="1">
              </div>
              <div class="col-md-3 mb-3" id="backupCronGroup" style="display: none;">
                <label for="backupCron" class="form-label">CRON Expression</label>
                <input type="text" class="form-control" id="backupCron" placeholder="0 0 2 * * ?">
                <small class="text-muted">sec min hour dom mon dow</small>
              </div>
              <div class="col-md-3 mb-3">
                <label for="backupWindowStart" class="form-label">Time Window Start</label>
                <input type="time" class="form-control" id="backupWindowStart">
              </div>
              <div class="col-md-3 mb-3">
                <label for="backupWindowEnd" class="form-label">Time Window End</label>
                <input type="time" class="form-control" id="backupWindowEnd">
                <small class="text-muted">Leave empty for any time</small>
              </div>
            </div>
          </div>
        </div>

        <div class="card mb-3">
          <div class="card-header">Retention Policy</div>
          <div class="card-body">
            <div class="row align-items-end">
              <div class="col-md-2 mb-3">
                <label for="backupMaxFiles" class="form-label">Max Backup Files</label>
                <input type="number" class="form-control" id="backupMaxFiles" value="10" min="1">
              </div>
              <div class="col-md-2 mb-3">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="backupUseTiered" onchange="toggleTieredRetention()">
                  <label class="form-check-label" for="backupUseTiered">Use Tiered Retention</label>
                </div>
              </div>
              <div id="tieredRetentionGroup" class="col-md-8" style="display: none;">
                <div class="row">
                  <div class="col mb-3">
                    <label for="backupHourly" class="form-label small">Hourly</label>
                    <input type="number" class="form-control form-control-sm" id="backupHourly" value="24" min="0">
                  </div>
                  <div class="col mb-3">
                    <label for="backupDaily" class="form-label small">Daily</label>
                    <input type="number" class="form-control form-control-sm" id="backupDaily" value="7" min="0">
                  </div>
                  <div class="col mb-3">
                    <label for="backupWeekly" class="form-label small">Weekly</label>
                    <input type="number" class="form-control form-control-sm" id="backupWeekly" value="4" min="0">
                  </div>
                  <div class="col mb-3">
                    <label for="backupMonthly" class="form-label small">Monthly</label>
                    <input type="number" class="form-control form-control-sm" id="backupMonthly" value="12" min="0">
                  </div>
                  <div class="col mb-3">
                    <label for="backupYearly" class="form-label small">Yearly</label>
                    <input type="number" class="form-control form-control-sm" id="backupYearly" value="3" min="0">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="tab-pane fade" id="tab-server-mcp" role="tabpanel">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <span class="text-muted small">MCP allows LLM clients (Claude Desktop, Cursor) to interact with ArcadeDB using natural language.</span>
        <div>
          <button class="btn btn-sm btn-outline-primary" onclick="loadMCPConfig()"><i class="fa fa-sync"></i> Refresh</button>
          <button class="btn btn-sm btn-success" onclick="saveMCPConfig()"><i class="fa fa-save"></i> Save</button>
        </div>
      </div>

      <div id="mcpConfigForm">
        <div class="row">
          <!-- Left column: Settings -->
          <div class="col-md-5">
            <div class="card mb-2">
              <div class="card-header py-1"><strong>Settings</strong></div>
              <div class="card-body py-2">
                <div class="d-flex align-items-center mb-2">
                  <label for="mcpEnabled" class="form-label mb-0 me-2 small">MCP Server</label>
                  <select id="mcpEnabled" class="form-select form-select-sm" style="width:auto">
                    <option value="true">Enabled</option>
                    <option value="false">Disabled</option>
                  </select>
                </div>
                <div class="small fw-bold mb-1">Permissions</div>
                <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="mcpAllowReads" checked disabled><label class="form-check-label small" for="mcpAllowReads">Reads</label></div>
                <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="mcpAllowInsert"><label class="form-check-label small" for="mcpAllowInsert">Insert</label></div>
                <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="mcpAllowUpdate"><label class="form-check-label small" for="mcpAllowUpdate">Update</label></div>
                <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="mcpAllowDelete"><label class="form-check-label small" for="mcpAllowDelete">Delete</label></div>
                <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="mcpAllowSchemaChange"><label class="form-check-label small" for="mcpAllowSchemaChange">Schema</label></div>
                <hr class="my-2">
                <div class="small fw-bold mb-1">Allowed Users</div>
                <div class="input-group input-group-sm mb-1" style="max-width:280px">
                  <input type="text" class="form-control" id="mcpNewUser" placeholder="Username">
                  <button class="btn btn-outline-secondary" onclick="addMCPUser()">Add</button>
                </div>
                <div id="mcpUserList"></div>
              </div>
            </div>
          </div>

          <!-- Right column: Connection Info -->
          <div class="col-md-7">
            <div class="card mb-2">
              <div class="card-header py-1"><strong>Connection Info</strong></div>
              <div class="card-body py-2">
                <div class="d-flex align-items-center mb-2">
                  <label for="mcpAuthMethod" class="form-label mb-0 me-2 small">Auth Method</label>
                  <select id="mcpAuthMethod" class="form-select form-select-sm" style="width:auto" onchange="onMcpAuthMethodChange()">
                    <option value="basic">Basic Auth (current user)</option>
                    <option value="apitoken">API Token</option>
                  </select>
                  <select id="mcpTokenSelect" class="form-select form-select-sm ms-2" style="width:auto;display:none" onchange="updateMCPConnectionInfo()">
                    <option value="">Select token...</option>
                  </select>
                </div>
                <ul class="nav nav-tabs nav-tabs-sm mb-2" role="tablist">
                  <li class="nav-item"><a class="nav-link active py-1 small" data-toggle="tab" href="#mcp-config-claude-desktop">Claude Desktop</a></li>
                  <li class="nav-item"><a class="nav-link py-1 small" data-toggle="tab" href="#mcp-config-claude-code">Claude Code / Cursor</a></li>
                </ul>
                <div class="tab-content">
                  <div class="tab-pane fade show active" id="mcp-config-claude-desktop" role="tabpanel">
                    <p class="small text-muted mb-1">Copy into <code>claude_desktop_config.json</code> (requires <code>npx</code> / Node.js):</p>
                    <pre class="bg-light p-2 rounded small mb-1" id="mcpConfigDesktop" style="max-height:220px;overflow:auto;font-size:0.8rem"></pre>
                    <button class="btn btn-sm btn-primary" onclick="copyMCPConfig('mcpConfigDesktop')"><i class="fa fa-copy"></i> Copy</button>
                  </div>
                  <div class="tab-pane fade" id="mcp-config-claude-code" role="tabpanel">
                    <p class="small text-muted mb-1">Add with <code>claude mcp add arcadedb</code> or copy into MCP settings:</p>
                    <pre class="bg-light p-2 rounded small mb-1" id="mcpConfigCode" style="max-height:220px;overflow:auto;font-size:0.8rem"></pre>
                    <button class="btn btn-sm btn-primary" onclick="copyMCPConfig('mcpConfigCode')"><i class="fa fa-copy"></i> Copy</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="tab-pane fade" id="tab-server-tokens" role="tabpanel">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <span class="text-muted small">Manage long-lived API tokens for programmatic access (MCP, REST API integrations).</span>
        <div>
          <button class="btn btn-sm btn-outline-primary" onclick="loadApiTokens()"><i class="fa fa-sync"></i> Refresh</button>
          <button class="btn btn-sm btn-success" onclick="showCreateTokenForm()"><i class="fa fa-plus"></i> Create Token</button>
        </div>
      </div>

      <div class="row">
        <div class="col-12">
          <div class="table-responsive">
            <table id="apiTokensTable" class="table table-striped table-sm" style="width: 100%"></table>
          </div>
        </div>
      </div>

      <!-- Create Token Modal -->
      <div class="modal fade" id="createTokenModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Create API Token</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <div class="row mb-3">
                <div class="col-md-4">
                  <label for="tokenName" class="form-label">Name</label>
                  <input type="text" class="form-control" id="tokenName" placeholder="e.g. MCP Read-Only">
                </div>
                <div class="col-md-4">
                  <label for="tokenDatabase" class="form-label">Database</label>
                  <select id="tokenDatabase" class="form-select" onchange="loadTypesForTokenDatabase()">
                    <option value="*">* (All databases)</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label for="tokenExpiration" class="form-label">Expiration</label>
                  <input type="date" class="form-control" id="tokenExpiration" placeholder="Never">
                  <small class="text-muted">Leave empty for no expiration</small>
                </div>
              </div>

              <h6>Type Permissions</h6>
              <table class="table table-sm table-bordered" id="tokenPermissionsTable">
                <thead>
                  <tr>
                    <th>Type</th>
                    <th class="text-center" style="width:80px">Create</th>
                    <th class="text-center" style="width:80px">Read</th>
                    <th class="text-center" style="width:80px">Update</th>
                    <th class="text-center" style="width:80px">Delete</th>
                    <th style="width:50px"></th>
                  </tr>
                </thead>
                <tbody>
                  <tr data-type="*">
                    <td><code>*</code> (default)</td>
                    <td class="text-center"><input type="checkbox" class="form-check-input perm-create"></td>
                    <td class="text-center"><input type="checkbox" class="form-check-input perm-read" checked></td>
                    <td class="text-center"><input type="checkbox" class="form-check-input perm-update"></td>
                    <td class="text-center"><input type="checkbox" class="form-check-input perm-delete"></td>
                    <td></td>
                  </tr>
                </tbody>
              </table>
              <div class="mb-3">
                <div class="input-group input-group-sm" style="max-width: 350px">
                  <select id="tokenNewType" class="form-select"><option value="">Add type...</option></select>
                  <button class="btn btn-outline-secondary" onclick="addTokenTypeRow()">Add</button>
                </div>
              </div>

              <h6>Database Permissions</h6>
              <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="tokenPermSchema"><label class="form-check-label small" for="tokenPermSchema">Schema Changes</label></div>
              <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="tokenPermSettings"><label class="form-check-label small" for="tokenPermSettings">Database Settings</label></div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-primary" onclick="createApiToken()">Create Token</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Token Created Modal -->
      <div class="modal fade" id="tokenCreatedModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header bg-success text-white">
              <h5 class="modal-title">Token Created</h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <div class="alert alert-warning small mb-2">
                <i class="fa fa-exclamation-triangle"></i> Save this token now. It will not be shown again.
              </div>
              <div class="input-group">
                <input type="text" class="form-control font-monospace" id="createdTokenValue" readonly>
                <button class="btn btn-primary" onclick="copyCreatedToken()"><i class="fa fa-copy"></i> Copy</button>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

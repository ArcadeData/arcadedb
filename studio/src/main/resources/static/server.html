<div class="tab-pane fade" id="tab-server" role="tabpanel">
  <div class="d-flex align-items-center px-3 py-2" style="border-bottom: 1px solid var(--border-light);">
    <div class="flex-grow-1 d-flex align-items-center gap-3">
      <span id="serverConnectionCompact" style="font-size: 0.88rem; color: var(--text-secondary); cursor: pointer; position: relative;" onclick="toggleServerInfoPopover()">
        <i class="fa fa-server" style="color: var(--color-brand); margin-right: 6px;"></i>
        <span id="serverConnectionLabel"></span>
        <i class="fa fa-chevron-down" style="font-size: 0.6rem; margin-left: 4px; color: var(--text-lightest);"></i>
        <!-- Popover for full details -->
        <div id="serverInfoPopover" style="display:none; position:absolute; top:100%; left:0; z-index:10000; min-width:400px; background:var(--bg-card); border:1px solid var(--border-ddd); border-radius:8px; box-shadow:0 4px 16px var(--shadow-dropdown); padding:14px 18px; margin-top:4px; font-size:0.82rem; color:var(--text-secondary);">
          <div id="serverInfoPopoverBody"></div>
        </div>
      </span>
    </div>
    <div class="d-flex align-items-center gap-2">
      <button class="btn btn-sm" style="color:red;" onclick="shutdownServer()" title="Shutdown Server"><i class="fas fa-power-off"></i></button>
    </div>
  </div>

  <div class="d-flex justify-content-around">
    <div class="p-1 d-flex align-items-center gap-2">
      <button class="btn btn-pill" onclick="updateServer()">Refresh <i class="fa fa-sync"></i></button>
      <select id="serverRefreshTimeout" class="form-select" onchange="startServerRefreshTimer(true)">
        <option value="0">Off</option>
        <option value="10">Every 10 sec</option>
        <option value="30">Every 30 sec</option>
        <option value="60">Every 1 min</option>
        <option value="300">Every 5 min</option>
      </select>
    </div>
    <div class="flex-grow-1">
      <ul class="nav nav-tabs text-center" id="tabs-database" style="float: right">
        <li class="nav-item"><a data-toggle="tab" href="#tab-server-summary" class="active show nav-link" id="tab-summary-sel">Summary</a></li>
        <li class="nav-item"><a data-toggle="tab" href="#tab-server-sessions" class="nav-link" id="tab-server-sessions-sel">Sessions</a></li>
        <li class="nav-item"><a data-toggle="tab" href="#tab-server-events" class="nav-link" id="tab-server-events-sel">Events</a></li>
        <li class="nav-item"><a data-toggle="tab" href="#tab-metrics" class="nav-link" id="tab-metrics-sel">Metrics</a></li>
        <li class="nav-item"><a data-toggle="tab" href="#tab-server-settings" class="nav-link" id="tab-server-settings-sel">Server Settings</a></li>
        <li class="nav-item"><a data-toggle="tab" href="#tab-server-backup" class="nav-link" id="tab-server-backup-sel">Backup</a></li>
      </ul>
    </div>
  </div>

  <br />

  <div class="tab-content px-2">
    <div class="tab-pane fade show active" id="tab-server-summary" role="tabpanel">
      <div class="row">
        <div class="col-6"><b>Operating System</b></div>
        <div class="col-6"><b>ArcadeDB Server</b></div>
      </div>
      <div class="row">
        <div class="col-xs-12 col-md-2">
          <div id="serverChartOSCPU" style="min-height: 220px"></div>
        </div>
        <div class="col-xs-12 col-md-2">
          <div id="serverChartOSRAM" style="min-height: 220px"></div>
        </div>
        <div class="col-xs-12 col-md-2">
          <div id="serverChartOSDisk" style="min-height: 220px"></div>
        </div>
        <div class="col-xs-12 col-md-2">
          <div id="serverChartServerRAM" style="min-height: 220px"></div>
        </div>
        <div class="col-xs-12 col-md-2">
          <div id="serverChartCache" style="min-height: 220px"></div>
        </div>
        <div class="col-xs-12 col-md-2">
          <div id="serverEventsSummary">
            <table style="font-size: 140%; border-spacing: 10px; margin: 0 auto; cursor: pointer" onclick="globalActivateTab('tab-server-events')">
              <tbody>
                <tr>
                  <td style="padding-right: 10px"><span style="color: red">Errors</span></td>
                  <td id="serverEventsSummaryErrors">0</td>
                </tr>
                <tr>
                  <td style="padding-right: 10px"><span style="color: orange">Warnings</span></td>
                  <td id="serverEventsSummaryWarnings">0</td>
                </tr>
                <tr>
                  <td style="padding-right: 10px"><span style="color: blue">Info</span></td>
                  <td id="serverEventsSummaryInfo">0</td>
                </tr>
                <tr>
                  <td style="padding-right: 10px">Hints</td>
                  <td id="serverEventsSummaryHints">0</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="row mt-2">
        <b>HTTP Requests</b>
      </div>
      <div class="row">
        <div class="col-12">
          <div id="serverChartCommands" style="min-height: 250px"></div>
        </div>
      </div>
    </div>

    <div class="tab-pane fade show" id="tab-server-sessions" role="tabpanel">
      <div class="row mb-3">
        <div class="col-12 d-flex justify-content-between align-items-center">
          <span>Active authentication sessions</span>
          <button class="btn btn-sm btn-outline-primary" onclick="loadServerSessions()">
            <i class="fa fa-sync"></i> Refresh
          </button>
        </div>
      </div>
      <div class="row">
        <div class="col-12">
          <div class="table-responsive">
            <table id="serverSessions" class="table table-striped table-sm" style="width: 100%"></table>
          </div>
        </div>
      </div>
    </div>

    <div class="tab-pane fade show" id="tab-server-events" role="tabpanel">
      <div class="row">
        <div class="col-1"><label for="serverEventsFile">File</label></div>
        <div class="col-3"><select id="serverEventsFile"></select></div>
        <div class="col-1"><label for="serverEventsType">Type</label></div>
        <div class="col-1">
          <select id="serverEventsType">
            <option value="ALL">ALL</option>
            <option value="CRITICAL">CRITICAL</option>
            <option value="WARNING">WARNING</option>
            <option value="INFO">INFO</option>
            <option value="HINT">HINT</option>
          </select>
        </div>
        <div class="col-1"><label for="serverEventsComponent">Component</label></div>
        <div class="col-2">
          <select id="serverEventsComponent">
            <option value="ALL">ALL</option>
          </select>
        </div>
        <div class="col-1"><label for="serverEventsDb">Database</label></div>
        <div class="col-2">
          <select id="serverEventsDb">
            <option value="ALL">ALL</option>
          </select>
        </div>
      </div>
      <br />
      <div class="row">
        <div class="col-12">
          <div class="table-responsive">
            <table id="serverEvents" class="table table-striped table-sm" style="width: 100%; table-layout: fixed"></table>
          </div>
        </div>
      </div>
    </div>

    <div class="tab-pane fade show" id="tab-metrics" role="tabpanel">
      <div class="row">
        <div class="col-12">
          <div class="table-responsive">
            <table id="serverMetrics" class="table table-striped table-sm" style="width: 100%; table-layout: fixed"></table>
          </div>
        </div>
      </div>
    </div>

    <div class="tab-pane" id="tab-server-settings" role="tabpanel">
      <div class="row">
        <div class="col-12">
          <div class="table-responsive">
            <table id="serverSettings" class="table table-striped table-sm" style="width: 100%; table-layout: fixed"></table>
          </div>
        </div>
      </div>
    </div>

    <div class="tab-pane fade" id="tab-server-backup" role="tabpanel">
      <div class="row mb-3">
        <div class="col-12">
          <div class="d-flex justify-content-between align-items-center">
            <h5><i class="fa fa-archive"></i> Auto-Backup Configuration</h5>
            <div>
              <button class="btn btn-sm btn-outline-primary" onclick="loadBackupConfig()">
                <i class="fa fa-sync"></i> Refresh
              </button>
              <button class="btn btn-sm btn-success" onclick="saveBackupConfig()">
                <i class="fa fa-save"></i> Save Configuration
              </button>
            </div>
          </div>
        </div>
      </div>

      <div id="backupConfigStatus" class="row mb-3">
        <div class="col-12">
          <div class="alert alert-info" role="alert">
            <span id="backupStatusMessage">Loading backup configuration...</span>
          </div>
        </div>
      </div>

      <div id="backupConfigForm" style="display: none;">
        <div class="card mb-3">
          <div class="card-header">General Settings</div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-4 mb-3">
                <label for="backupEnabled" class="form-label">Auto-Backup Enabled</label>
                <select id="backupEnabled" class="form-select">
                  <option value="true">Yes</option>
                  <option value="false">No</option>
                </select>
              </div>
              <div class="col-md-4 mb-3">
                <label for="backupDirectory" class="form-label">Backup Directory</label>
                <input type="text" class="form-control" id="backupDirectory" value="./backups">
              </div>
              <div class="col-md-4 mb-3">
                <label for="backupRunOnServer" class="form-label">Run On Server</label>
                <select id="backupRunOnServer" class="form-select">
                  <option value="$leader">Leader Only ($leader)</option>
                  <option value="*">All Servers (*)</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <div class="card mb-3">
          <div class="card-header">Schedule</div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-3 mb-3">
                <label for="backupScheduleType" class="form-label">Schedule Type</label>
                <select id="backupScheduleType" class="form-select" onchange="toggleBackupScheduleFields()">
                  <option value="frequency">Frequency-based</option>
                  <option value="cron">CRON Expression</option>
                </select>
              </div>
              <div class="col-md-3 mb-3" id="backupFrequencyGroup">
                <label for="backupFrequency" class="form-label">Frequency (minutes)</label>
                <input type="number" class="form-control" id="backupFrequency" value="60" min="1">
              </div>
              <div class="col-md-3 mb-3" id="backupCronGroup" style="display: none;">
                <label for="backupCron" class="form-label">CRON Expression</label>
                <input type="text" class="form-control" id="backupCron" placeholder="0 0 2 * * ?">
                <small class="text-muted">sec min hour dom mon dow</small>
              </div>
              <div class="col-md-3 mb-3">
                <label for="backupWindowStart" class="form-label">Time Window Start</label>
                <input type="time" class="form-control" id="backupWindowStart">
              </div>
              <div class="col-md-3 mb-3">
                <label for="backupWindowEnd" class="form-label">Time Window End</label>
                <input type="time" class="form-control" id="backupWindowEnd">
                <small class="text-muted">Leave empty for any time</small>
              </div>
            </div>
          </div>
        </div>

        <div class="card mb-3">
          <div class="card-header">Retention Policy</div>
          <div class="card-body">
            <div class="row align-items-end">
              <div class="col-md-2 mb-3">
                <label for="backupMaxFiles" class="form-label">Max Backup Files</label>
                <input type="number" class="form-control" id="backupMaxFiles" value="10" min="1">
              </div>
              <div class="col-md-2 mb-3">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="backupUseTiered" onchange="toggleTieredRetention()">
                  <label class="form-check-label" for="backupUseTiered">Use Tiered Retention</label>
                </div>
              </div>
              <div id="tieredRetentionGroup" class="col-md-8" style="display: none;">
                <div class="row">
                  <div class="col mb-3">
                    <label for="backupHourly" class="form-label small">Hourly</label>
                    <input type="number" class="form-control form-control-sm" id="backupHourly" value="24" min="0">
                  </div>
                  <div class="col mb-3">
                    <label for="backupDaily" class="form-label small">Daily</label>
                    <input type="number" class="form-control form-control-sm" id="backupDaily" value="7" min="0">
                  </div>
                  <div class="col mb-3">
                    <label for="backupWeekly" class="form-label small">Weekly</label>
                    <input type="number" class="form-control form-control-sm" id="backupWeekly" value="4" min="0">
                  </div>
                  <div class="col mb-3">
                    <label for="backupMonthly" class="form-label small">Monthly</label>
                    <input type="number" class="form-control form-control-sm" id="backupMonthly" value="12" min="0">
                  </div>
                  <div class="col mb-3">
                    <label for="backupYearly" class="form-label small">Yearly</label>
                    <input type="number" class="form-control form-control-sm" id="backupYearly" value="3" min="0">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="tab-pane fade" id="tab-query" role="tabpanel">
  <div class="row" id="queryPanel">
    <div class="col-1">
      <select id="inputLanguage" class="col-12 form-control">
        <option value="sql">SQL</option>
        <option value="gremlin">Gremlin</option>
        <option value="cypher">Cypher</option>
        <option value="mongodb">MongoDB</option>
      </select>
    </div>

    <div class="col-11">
      <textarea id="inputCommand" name="inputCommand"></textarea>
      <button class="btn btn-primary" onclick="executeCommand(true)" style="z-index: 100; position:absolute; top: 10px; right: 30px;"><i class="fa fa-play"></i>
        <img id="executeSpinner" class="ui-loading" src="/images/color-spin-small.svg" style="display: none;">
      </button>
    </div>

    <div class="col-12 text-right">
      <label>Result <span id="result-num"></span>&nbsp;records, </label>
      <label>Time <span id="result-elapsed"></span>ms</label>
    </div>

    <div class="col-12">
      <ul class="nav nav-tabs" id="tabs-command">
        <li class="nav-item"><a data-toggle="tab" href="#tab-graph" class="active nav-link" id="tab-graph-sel">
          <center><i class="fa fa-project-diagram"></i><br><span class="mini-text">Graph</span></center>
        </a></li>
        <li class="nav-item"><a data-toggle="tab" href="#tab-table" class="nav-link" id="tab-table-sel">
          <center><i class="fa fa-table"></i><br><span class="mini-text">Table</span></center>
        </a></li>
        <li class="nav-item"><a data-toggle="tab" href="#tab-json" class="nav-link" id="tab-json-sel">
          <center><i class="fa fa-file-code"></i><br><span class="mini-text">Json</span></center>
        </a></li>
      </ul>

      <div class="tab-content">
        <div class="tab-pane fade show active" id="tab-graph" role="tabpanel">
          <div class="row">
            <div class="col-12">
              <nav class="navbar navbar-expand-lg navbar-light">
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                  <div class="form-inline my-2 my-lg-0">
                    <input id="inputGraphSearch" class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-success my-2 my-sm-0" onclick="searchInGraph()" href="#">Search</button>
                  </div>
                  <ul class="navbar-nav mr-auto">
                    <li class="nav-item">

                    </li>
                  </ul>
                  <ul class="navbar-nav">
                    <li class="nav-item">
                      <a class="nav-link" href="#" onclick="toggleSidebar()" href="#" id="toggleSidebar"><i class="fa fa-eye-slash"></i> Hide
                        Properties</a>
                    </li>

                    <li class="nav-item">
                      <a class="nav-link" href="#" onclick="cutSelection()"><i class="fa fa-cut"></i> Cut</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="#" onclick="cropSelection()"><i class="fa fa-crop"></i> Crop</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="#" onclick="renderGraph()"><i class="fa fa-sync"></i> Redraw</a>
                    </li>
                    <li class="nav-item dropdown">
                      <a class="nav-link dropdown-toggle" href="#" role="button" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle"
                         data-toggle="dropdown">
                        <i class="fa fa-upload"></i> Import
                      </a>
                      <ul class="dropdown-menu" aria-labelledby="navbarDropdown" style="width: 300px">

                        <li class="dropdown-item">
                          <a class="nav-link" href="#" disabled>JSON</a>
                        </li>

                        <li class="dropdown-item">
                          <a class="nav-link" href="#" disabled>GraphML</a>
                        </li>

                      </ul>
                    </li>
                    <li class="nav-item dropdown">
                      <a class="nav-link dropdown-toggle" href="#" role="button" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle"
                         data-toggle="dropdown">
                        <i class="fa fa-download"></i> Export
                      </a>
                      <ul class="dropdown-menu" aria-labelledby="navbarDropdown" style="width: 300px">

                        <li class="dropdown-item">
                          <a class="nav-link" href="#" onclick="exportGraph('json')">JSON</a>
                        </li>

                        <li class="dropdown-item">
                          <a class="nav-link" href="#" onclick="exportGraph('graphml')">GraphML</a>
                        </li>

                      </ul>
                    </li>
                    <li class="nav-item dropdown">
                      <a class="nav-link dropdown-toggle" href="#" role="button" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle"
                         data-toggle="dropdown">
                        <i class="fa fa-sliders-h"></i> Settings
                      </a>
                      <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown" style="width: 300px">

                        <li class="dropdown-item">
                          <span id="customToolbar"></span>
                        </li>

                        <li class="dropdown-item">
                          <label for="graphSpacing" class="form-label">Graph Spacing</label>
                          <input id="graphSpacing" class="form-control" type="range" class="custom-range" min="10" max="100" step="10" value="20"
                                 style="width: 100%">
                        </li>

                      </ul>
                    </li>
                    <li class="nav-item">
                      <button type="button" class="btn" data-toggle="tooltip" data-placement="top" data-html="true"
                              title="1) Hold MOUSE CLICK for context menu<br>2) CMD + MOUSE for block selection">
                        <i class="fa fa-question-circle"></i>
                      </button>
                    </li>
                  </ul>
                </div>
              </nav>
            </div>
          </div>

          <div class="row" style="overflow-x: hidden;">
            <div class="col-9" id="graphMainPanel">
              <div id="graph" style="height: 800px; width: 100%;"></div>
            </div>
            <div class="col-3" id="graphPropertiesPanel">
              <div class="card-header-tab card-header" style="height: 100%;">
                <span id="graphPropertiesType">Select an element to see its properties</span>
                <table id="graphPropertiesTable" class="table table-striped table-sm" style="width: 100%"></table>
              </div>
            </div>
          </div>
        </div>

        <div class="tab-pane fade" id="tab-table" role="tabpanel">
          <table id="result" class="table table-striped table-sm" style="width: 100%"></table>
        </div>

        <div class="tab-pane fade" id="tab-json" role="tabpanel">
          <textarea id="resultJson" style="width: 100%; height: 600px;" disabled></textarea>
        </div>
      </div>

    </div>
  </div>

</div>

<script>
$(function () {
  $('[data-toggle="tooltip"]').tooltip()

  $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
    executeCommand(false);
  });

  $("#graphSpacing").change( function(){
    globalGraphSpacing = parseInt( $("#graphSpacing").val() );
    renderGraph();
  });

  $("#inputLanguage").change( function(){
    editor.setOption("mode", getEditorMode() );
  });

  $('.dropdown-menu').on("click.bs.dropdown", function (e) {
    e.stopPropagation();
    e.preventDefault();
  });

  renderCodeEditor();
});

function renderCodeEditor(){
  editor = CodeMirror.fromTextArea(document.getElementById('inputCommand'), {
    mode: getEditorMode(),
    indentWithTabs: false,
    smartIndent: true,
    lineNumbers: false,
    matchBrackets : true,
    autofocus: true,
    viewportMargin: Infinity,
    theme: 'neo'
  });

  setTimeout(function() {
    editor.refresh();
  },1);
}

function getEditorMode(){
  let language = $("#inputLanguage").val();
  let mime = null;
  if( language == "sql" )
    mime = "text/x-sql";
  else if( language == "cypher" )
    mime = "application/x-cypher-query";
  else if( language == "gremlin" )
    mime = "sql";
  else if( language == "mongodb" )
    mime = "application/json";
  return mime;
}
</script>
